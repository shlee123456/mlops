# Ralph Progress Log
Started: Sat Jan 25 00:00:00 KST 2026
---

## Codebase Patterns
- Grafana 대시보드 JSON에 `uid` 필드를 추가해야 드릴다운 링크에서 `/d/<uid>` 형식으로 참조 가능
- Loki 쿼리에서 변수 미입력 시 전체 매칭하려면 `${varname:-.+}` 정규식 기본값 사용
- `type: textbox` 변수는 자유 입력, `type: custom`은 쉼표 구분 query 값에서 선택
- Training/System 로그는 별도 job 라벨 사용 ({job="training"}, {job="system"}) - endpoint/model 필터 불필요
- jq . 명령으로 JSON 유효성 검증 가능
- `type: query` 변수에 `label_values(metric, label)` 사용하여 동적으로 값 로딩 가능
- 드릴다운 대상 대시보드의 변수에 `includeAll: true, allValue: ".*"` 설정하면 미선택 시 전체 매칭
- 에러 로그 패널에서 `fieldConfig.defaults.links`로 다른 대시보드 드릴다운 링크 추가 가능
- 시계열 패널의 드릴다운 URL에 `${__field.labels.X}`로 라벨 값, `${__from}/${__to}`로 시간 범위 전달
- Training 메트릭은 Prometheus에 push되는 게이지 메트릭 (training_loss, training_step 등) 사용
- Loki 이벤트 로그를 table 패널로 표시할 때 `extractFields` + `organize` transformation 활용
- stat 타입 패널(서비스 상태 UP/DOWN)에도 `fieldConfig.defaults.links`로 드릴다운 가능

---

## 2026-01-25 - US-001
- logs-dashboard.json에 templating.list 섹션 추가 (endpoint, model, status_code 변수)
- Loki 쿼리를 JSON 파싱 + 조건부 정규식 필터링으로 수정
- uid: "logs-dashboard" 추가 (드릴다운 링크 대상)
- Error Logs 패널을 {job="fastapi"} 기반으로 변경하여 JSON 파싱 가능하도록 수정
- Files changed: deployment/monitoring/configs/grafana/dashboards/logs-dashboard.json
- **Learnings for future iterations:**
  - `${varname:-.+}` 패턴으로 빈 변수일 때 전체 매칭 가능
  - Training/System 로그는 구조화된 JSON이 아닐 수 있으므로 | json 파이프라인 적용 주의
  - Log Level Distribution 패널도 필터링 적용 시 일관된 뷰 제공
---

## 2026-01-25 - US-002
- inference-detail.json 상세 대시보드 생성 (uid: inference-detail)
- $endpoint 변수 (query: label_values(http_requests_total, endpoint))
- $model 변수 (query: label_values(llm_requests_total, model))
- 10개 패널 구현: 시간대별 요청수, p50/p95/p99 레이턴시, 에러율 시계열, 모델별 성능 비교, 성공률(gauge), 평균 레이턴시(stat), 총 요청수(stat), 토큰 생성률(stat), 최근 에러 로그(loki), 상태 코드 분포(piechart)
- 에러 로그 패널에 logs-dashboard로의 드릴다운 링크 추가
- 모든 Prometheus 쿼리에 endpoint/model 필터 적용
- Files changed: deployment/monitoring/configs/grafana/dashboards/inference-detail.json
- **Learnings for future iterations:**
  - `type: query` 변수에 `refresh: 2` 설정 시 대시보드 로딩/시간 범위 변경 시 자동 갱신
  - `allValue: ".*"` 설정으로 All 선택 시 정규식 전체 매칭
  - 로그 패널의 fieldConfig.defaults.links로 드릴다운 링크 연결 가능
  - 에러율 시계열은 4xx/5xx를 분리하면 더 정확한 원인 파악 가능
---

## 2026-01-25 - US-004
- inference-metrics.json의 3개 패널에 fieldConfig.defaults.links 드릴다운 링크 추가
- Panel id:2 (HTTP Request Latency): endpoint 변수로 inference-detail, logs-dashboard 연결
- Panel id:7 (LLM Request Rate): model 변수로 inference-detail, logs-dashboard 연결
- Panel id:8 (LLM Request Duration): model 변수로 inference-detail, logs-dashboard 연결
- 모든 링크에 시간 범위 전달 (from=${__from}&to=${__to})
- Files changed: deployment/monitoring/configs/grafana/dashboards/inference-metrics.json
- **Learnings for future iterations:**
  - `${__field.labels.labelname}` 으로 시계열 데이터의 라벨 값을 드릴다운 URL에 전달 가능
  - `${__from}`, `${__to}`로 현재 대시보드의 시간 범위를 그대로 전달
  - `targetBlank: false`로 같은 탭에서 드릴다운 열기 (뒤로가기로 복귀 가능)
  - 한 패널에 여러 링크를 추가하면 클릭 시 선택 메뉴가 나타남
---

## 2026-01-25 - US-003
- training-detail.json 상세 대시보드 생성 (uid: training-detail)
- $experiment_id 변수 (textbox), $run_id 변수 (textbox) 정의
- 7개 패널 구현: Loss curve(train+eval), Learning rate schedule, GPU 사용률, GPU 메모리 사용량, Training step(stat), Epoch(stat), 하이퍼파라미터 정보(table/Loki)
- 모든 Prometheus 쿼리에 run_id, experiment_id 필터 적용 (`${varname:-.+}` 패턴 사용)
- 하이퍼파라미터 테이블은 Loki에서 `event="hyperparameters"` 로그를 JSON 파싱하여 표시
- Files changed: deployment/monitoring/configs/grafana/dashboards/training-detail.json
- **Learnings for future iterations:**
  - Training 메트릭은 Prometheus push 방식 (training_loss, training_learning_rate 등)으로 가정
  - textbox 변수는 refresh 설정 불필요 (사용자 직접 입력)
  - 하이퍼파라미터처럼 구조화된 이벤트 로그는 Loki + JSON 파싱 + table 타입으로 표시 가능
  - GPU 메모리는 used/total 두 시리즈를 함께 표시하면 비율 직관적 파악 가능
---

## 2026-01-25 - US-005
- system-overview.json의 서비스 상태 패널 3개(FastAPI, vLLM, MLflow)에 드릴다운 링크 추가
- Application Metrics 패널 2개(HTTP Requests Rate, HTTP Request Duration)에 inference-metrics 드릴다운 링크 추가
- training-metrics.json에 uid: "training-metrics" 추가 (드릴다운 링크 대상으로 사용하기 위해)
- 모든 링크에 시간 범위 전달 (from=${__from}&to=${__to})
- Files changed: deployment/monitoring/configs/grafana/dashboards/system-overview.json, deployment/monitoring/configs/grafana/dashboards/training-metrics.json
- **Learnings for future iterations:**
  - stat 타입 패널(서비스 상태)에도 fieldConfig.defaults.links로 드릴다운 링크 추가 가능
  - 드릴다운 대상 대시보드에 uid가 반드시 설정되어 있어야 /d/<uid> 형식 링크가 작동함
  - targetBlank: false로 설정하면 같은 탭에서 이동 (뒤로가기로 복귀 가능)
---
