# Ralph Progress Log
Started: Wed Jan 28 03:29:39 PM KST 2026
---

## 2026-01-28 15:34 - US-001
- Alloy JSON 파싱 파이프라인에서 FastAPI 로그의 "event" 필드가 누락되어 Loki에 데이터가 저장되지 않던 문제 발견 및 수정
- Files changed:
  - deployment/monitoring/configs/alloy/config.alloy
- **Learnings for future iterations:**
  - FastAPI는 structlog를 사용하여 "event" 필드에 메시지를 저장하는데, 일반적인 로그 포맷은 "message" 필드 사용
  - Alloy의 `stage.json`에서 필드를 추출할 때, 로그 포맷과 정확히 일치해야 함
  - `stage.template`을 사용하면 여러 필드 중 하나를 선택하여 output으로 매핑 가능
  - Loki instant query(`/loki/api/v1/query`)는 in-memory 버퍼만 조회하므로, 과거 데이터는 query_range 사용 필요
  - Alloy는 파일 끝(EOF)에서 tailing을 시작하므로, 기존 로그는 수집되지 않고 새 로그만 수집됨
  - Docker logs와 file-based logs 모두 정상 작동 확인 (각각 다른 label 사용)
  - JSON 필드 추출 확인 방법: Loki API의 stream 객체에서 labels 확인
---
