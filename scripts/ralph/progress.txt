# Ralph Progress Log
Started: 2026-01-28
---

## Codebase Patterns
- **Docker 로그 파일**: 컨테이너 로그를 호스트에 저장 시 `/logs` 디렉토리를 호스트의 `logs/[service]/`에 마운트. Dockerfile에서 `/logs` 디렉토리 생성 필수.
- **Bash 로그 리다이렉션**: 백그라운드 프로세스 로그를 파일과 콘솔에 동시 출력하려면 `> >(tee -a logfile) 2> >(tee -a logfile >&2)` 패턴 사용
- **HuggingFace 캐시**: docker-compose에서 HuggingFace 캐시를 read-only(`:ro`)로 마운트하면 모델 다운로드 불가. 쓰기 가능하게 마운트 필요.
- **vLLM 로그 리다이렉션**: Process substitution `> >(tee ...)` 방식이 일부 환경에서 작동하지 않을 수 있음. 서브셸 + 파이프 방식 `(cmd 2>&1 | tee log) &`가 더 안정적.

---
## 2026-01-28 14:40 - US-001 (진행 중)
- vLLM 로그 파일 생성 테스트 진행
- **Files changed:**
  - `docker/docker-compose.serving.yml`: HuggingFace 캐시 read-only 제거
  - `deployment/serving/start-vllm.sh`: 로그 리다이렉션 방식 변경 (process substitution → subshell + pipe)

- **발견된 문제:**
  1. HuggingFace 캐시가 `:ro`로 마운트되어 모델 다운로드 실패
  2. `> >(tee ...)` process substitution 방식의 로그 리다이렉션이 컨테이너 환경에서 작동하지 않음
  3. 로그 파일이 생성되지 않는 문제 발견

- **수정 내용:**
  1. docker-compose.serving.yml에서 `~/.cache/huggingface:/root/.cache/huggingface:ro` → `:ro` 제거
  2. start-vllm.sh의 로그 리다이렉션을 `(cmd 2>&1 | tee -a "$LOG" | sed -u 's/^/[Model1] /') &` 방식으로 변경

- **Learnings for future iterations:**
  - **Pattern**: Docker Compose에서 볼륨 마운트 시 `:ro` 플래그는 읽기 전용을 의미하며, 모델 다운로드나 캐시 생성이 필요한 경우 제거해야 함
  - **Gotcha**: Bash process substitution `> >(...)은 일부 Docker 환경에서 작동하지 않을 수 있음. 서브셸 + 파이프 방식이 더 안정적
  - **Context**: vLLM은 모델 로딩에 시간이 오래 걸림 (TinyLlama-1.1B도 수 분 소요)
  - **Next**: Docker 이미지 재빌드 및 실제 로그 파일 생성 테스트 필요
---
